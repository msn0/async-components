{"version":3,"sources":["../async-components.js"],"names":[],"mappings":"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","file":"async-components.es5.js","sourcesContent":["'use strict';\n\n((document) => {\n\n  const COMPONENT_ATTR = 'data-component';\n  const DETAIL_ATTR = 'data-detail';\n  const EVENT_ATTR = 'data-event';\n\n  const OBSERVER_CONFIG = {\n    attributes: true,\n    childList: true,\n    characterData: false,\n    subtree: true,\n    attributeFilter: [COMPONENT_ATTR]\n  };\n\n  function getText(response) {\n    return response.text();\n  }\n\n  function parse(params) {\n    let detail = params.node.getAttribute(DETAIL_ATTR);\n    params.eventName = params.node.getAttribute(EVENT_ATTR);\n    try {\n      params.detail = JSON.parse(detail);\n    } catch (e) {\n      params.detail = detail;\n    }\n\n    return Promise.resolve(params);\n  }\n\n  function getData(node) {\n    return (text) => parse({node, text});\n  }\n\n  function placeElement(params) {\n\n    var parser = new DOMParser();\n    var a = parser.parseFromString(params.text, \"text/html\");\n\n    [].slice.call(a.body.childNodes).forEach(function (e) {\n      var el;\n      if (e.nodeName === \"SCRIPT\") {\n        el = document.createElement('script');\n        el.appendChild(document.createTextNode(e.innerHTML));\n        params.node.appendChild(el);\n      } else {\n        params.node.appendChild(e);\n      }\n\n    });\n\n    return Promise.resolve(params);\n  }\n\n  function dispatchEvent(params) {\n    let e = new CustomEvent(params.eventName, {\n      detail: {\n        node: params.node,\n        data: params.detail\n      }\n    });\n    document.dispatchEvent(e);\n    return Promise.resolve(params.node);\n  }\n\n  function reportError() {\n    console.error(\"Error occured\");\n  }\n\n  function fetchNestedComponents(node) {\n    let nestedNodes = node.querySelectorAll(\"[\" + COMPONENT_ATTR + \"]\");\n    nodesToArray(nestedNodes).forEach(deferredNodeFetch);\n  }\n\n  function fetchComponent(node) {\n    let url = node.getAttribute(COMPONENT_ATTR);\n\n    fetch(url)\n      .then(getText)\n      .then(getData(node))\n      .then(placeElement)\n      .then(dispatchEvent)\n      .then(fetchNestedComponents)\n      .catch(reportError);\n  }\n\n  function filterComponents(node) {\n    return node.nodeType === 1 && node.getAttribute(COMPONENT_ATTR);\n  }\n\n  function deferredNodeFetch(node) {\n    return setTimeout(fetchComponent(node), 0);\n  }\n\n  function nodesToArray(nodes) {\n    return [].slice.call(nodes);\n  }\n\n  function filterNodes(nodes) {\n    nodesToArray(nodes)\n      .filter(filterComponents)\n      .forEach(deferredNodeFetch);\n  }\n\n  let observer = new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => {\n      filterNodes(mutation.addedNodes);\n    });\n  });\n\n  observer.observe(document.body, OBSERVER_CONFIG);\n\n})(document);\n"]}